<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="ex_esdb v0.7.1">


    <title>Multiple Stores — ex_esdb v0.7.1</title>

    <link rel="stylesheet" href="dist/html-elixir-KV3YOVJ3.css" />

      <link rel="canonical" href="https://hexdocs.pm/ex_esdb/multiple-stores.html" />

    <script defer src="dist/sidebar_items-099CC3AB.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
ex_esdb
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.7.1
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras="guides"></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ex_esdb</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>How ExESDB Handles Multiple Stores</h1>


  </div>


<p>This document describes the dynamic store creation and management capabilities added to ExESDB, allowing users to create multiple event stores on-demand within a single cluster.</p><h2 id="overview" class="section-heading"><a href="#overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Overview</span></h2><p>Previously, ExESDB was configured with a single store ID at startup. Now, with the <code class="inline">ExESDB.StoreManager</code>, users can:</p><ul><li>Create new stores dynamically at runtime</li><li>Remove stores when no longer needed</li><li>List and query store status and configuration</li><li>Use multiple stores simultaneously in the same cluster</li></ul><h2 id="architecture" class="section-heading"><a href="#architecture" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Architecture</span></h2><h3 id="components" class="section-heading"><a href="#components" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Components</span></h3><ol><li><strong>ExESDB.StoreManager</strong>: The core GenServer that manages multiple Khepri stores</li><li><strong>ExESDBGater.API</strong>: Updated API with store management functions</li><li><strong>ExESDB.GatewayWorker</strong>: Updated to handle store management operations</li></ol><h3 id="how-it-works" class="section-heading"><a href="#how-it-works" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">How It Works</span></h3><ol><li>The <code class="inline">StoreManager</code> replaces the single <code class="inline">Store</code> process in the supervision tree</li><li>Each store gets its own unique data directory under the base data directory</li><li>Stores are managed independently but share the same cluster infrastructure</li><li>All existing stream, subscription, and snapshot operations work with any managed store</li></ol><h2 id="api-reference" class="section-heading"><a href="#api-reference" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">API Reference</span></h2><h3 id="creating-a-store" class="section-heading"><a href="#creating-a-store" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Creating a Store</span></h3><pre><code class="makeup elixir" translate="no"><span class="c1"># Fire-and-forget operation</span><span class="w">
</span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="8961406203-1">(</span><span class="ss">:my_new_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8961406203-2">[</span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">15_000</span><span class="p" data-group-id="8961406203-2">]</span><span class="p" data-group-id="8961406203-1">)</span></code></pre><h3 id="removing-a-store" class="section-heading"><a href="#removing-a-store" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Removing a Store</span></h3><pre><code class="makeup elixir" translate="no"><span class="c1"># Fire-and-forget operation</span><span class="w">
</span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">remove_store</span><span class="p" data-group-id="7990084185-1">(</span><span class="ss">:my_store</span><span class="p" data-group-id="7990084185-1">)</span></code></pre><h3 id="listing-stores" class="section-heading"><a href="#listing-stores" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Listing Stores</span></h3><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="3745451857-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">stores</span><span class="p" data-group-id="3745451857-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">list_stores</span><span class="p" data-group-id="3745451857-2">(</span><span class="p" data-group-id="3745451857-2">)</span><span class="w">
</span><span class="c1"># Returns: %{store_id =&gt; %{status: :running, config: [...]}}</span></code></pre><h3 id="getting-store-status" class="section-heading"><a href="#getting-store-status" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Getting Store Status</span></h3><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="7998218941-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="ss">:running</span><span class="p" data-group-id="7998218941-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">get_store_status</span><span class="p" data-group-id="7998218941-2">(</span><span class="ss">:my_store</span><span class="p" data-group-id="7998218941-2">)</span></code></pre><h3 id="getting-store-configuration" class="section-heading"><a href="#getting-store-configuration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Getting Store Configuration</span></h3><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="5764478490-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p" data-group-id="5764478490-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">get_store_config</span><span class="p" data-group-id="5764478490-2">(</span><span class="ss">:my_store</span><span class="p" data-group-id="5764478490-2">)</span></code></pre><h2 id="store-operations" class="section-heading"><a href="#store-operations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Store Operations</span></h2><p>Once a store is created, you can use it with all existing operations:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Append events to a specific store</span><span class="w">
</span><span class="p" data-group-id="6015290403-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p" data-group-id="6015290403-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">append_events</span><span class="p" data-group-id="6015290403-2">(</span><span class="ss">:my_store</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;stream-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">events</span><span class="p" data-group-id="6015290403-2">)</span><span class="w">

</span><span class="c1"># Read events from a specific store</span><span class="w">
</span><span class="p" data-group-id="6015290403-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">events</span><span class="p" data-group-id="6015290403-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">get_events</span><span class="p" data-group-id="6015290403-4">(</span><span class="ss">:my_store</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;stream-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="6015290403-4">)</span><span class="w">

</span><span class="c1"># List streams in a specific store</span><span class="w">
</span><span class="p" data-group-id="6015290403-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">streams</span><span class="p" data-group-id="6015290403-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">get_streams</span><span class="p" data-group-id="6015290403-6">(</span><span class="ss">:my_store</span><span class="p" data-group-id="6015290403-6">)</span><span class="w">

</span><span class="c1"># Create subscriptions for a specific store</span><span class="w">
</span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">save_subscription</span><span class="p" data-group-id="6015290403-7">(</span><span class="ss">:my_store</span><span class="p">,</span><span class="w"> </span><span class="ss">:by_stream</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;$all&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;my_sub&quot;</span><span class="p" data-group-id="6015290403-7">)</span></code></pre><h2 id="configuration" class="section-heading"><a href="#configuration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Configuration</span></h2><h3 id="default-store" class="section-heading"><a href="#default-store" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Default Store</span></h3><p>The system still creates a default store on startup using the existing configuration:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># In runtime.exs</span><span class="w">
</span><span class="n">config</span><span class="w"> </span><span class="ss">:ex_esdb</span><span class="p">,</span><span class="w"> </span><span class="ss">:khepri</span><span class="p">,</span><span class="w">
  </span><span class="ss">data_dir</span><span class="p">:</span><span class="w"> </span><span class="n">data_dir</span><span class="p" data-group-id="5704759831-1">(</span><span class="p" data-group-id="5704759831-1">)</span><span class="p">,</span><span class="w">
  </span><span class="ss">store_id</span><span class="p">:</span><span class="w"> </span><span class="n">store_id</span><span class="p" data-group-id="5704759831-2">(</span><span class="p" data-group-id="5704759831-2">)</span><span class="p">,</span><span class="w">  </span><span class="c1"># This becomes the default store</span><span class="w">
  </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="n">timeout</span><span class="p" data-group-id="5704759831-3">(</span><span class="p" data-group-id="5704759831-3">)</span><span class="p">,</span><span class="w">
  </span><span class="ss">db_type</span><span class="p">:</span><span class="w"> </span><span class="n">db_type</span><span class="p" data-group-id="5704759831-4">(</span><span class="p" data-group-id="5704759831-4">)</span><span class="p">,</span><span class="w">
  </span><span class="ss">pub_sub</span><span class="p">:</span><span class="w"> </span><span class="n">pub_sub</span><span class="p" data-group-id="5704759831-5">(</span><span class="p" data-group-id="5704759831-5">)</span></code></pre><h3 id="dynamic-store-configuration" class="section-heading"><a href="#dynamic-store-configuration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Dynamic Store Configuration</span></h3><p>New stores inherit the default configuration but can override specific settings:</p><pre><code class="makeup elixir" translate="no"><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="3293596672-1">(</span><span class="ss">:custom_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3293596672-2">[</span><span class="w">
  </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">20_000</span><span class="p">,</span><span class="w">        </span><span class="c1"># Custom timeout</span><span class="w">
  </span><span class="c1"># data_dir is automatically set to base_dir/custom_store</span><span class="w">
</span><span class="p" data-group-id="3293596672-2">]</span><span class="p" data-group-id="3293596672-1">)</span></code></pre><h2 id="data-storage" class="section-heading"><a href="#data-storage" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Data Storage</span></h2><p>Each store gets its own data directory:</p><pre><code class="makeup elixir" translate="no"><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="w"> </span><span class="n">ex_esdb_store</span><span class="o">/</span><span class="w">          </span><span class="c1"># Default store</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="w"> </span><span class="n">user_data_store</span><span class="o">/</span><span class="w">        </span><span class="c1"># Custom store 1</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="w"> </span><span class="n">analytics_store</span><span class="o">/</span><span class="w">        </span><span class="c1"># Custom store 2</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="w"> </span><span class="n">audit_logs_store</span><span class="o">/</span><span class="w">       </span><span class="c1"># Custom store 3</span></code></pre><h2 id="use-cases" class="section-heading"><a href="#use-cases" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Use Cases</span></h2><h3 id="multi-tenant-applications" class="section-heading"><a href="#multi-tenant-applications" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Multi-Tenant Applications</span></h3><p>Create separate stores for each tenant:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Create tenant-specific stores</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="7463966435-1">(</span><span class="ss">:tenant_123_store</span><span class="p" data-group-id="7463966435-1">)</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="7463966435-2">(</span><span class="ss">:tenant_456_store</span><span class="p" data-group-id="7463966435-2">)</span><span class="w">

</span><span class="c1"># Use tenant-specific store for operations</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">append_events</span><span class="p" data-group-id="7463966435-3">(</span><span class="ss">:tenant_123_store</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;orders&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">events</span><span class="p" data-group-id="7463966435-3">)</span></code></pre><h3 id="domain-separation" class="section-heading"><a href="#domain-separation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Domain Separation</span></h3><p>Create stores for different business domains:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Separate stores by domain</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="3647286319-1">(</span><span class="ss">:user_management_store</span><span class="p" data-group-id="3647286319-1">)</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="3647286319-2">(</span><span class="ss">:order_processing_store</span><span class="p" data-group-id="3647286319-2">)</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="3647286319-3">(</span><span class="ss">:analytics_store</span><span class="p" data-group-id="3647286319-3">)</span></code></pre><h3 id="environment-specific-stores" class="section-heading"><a href="#environment-specific-stores" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Environment-Specific Stores</span></h3><p>Create stores for different purposes:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Development/testing stores</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="8015606802-1">(</span><span class="ss">:test_store</span><span class="p" data-group-id="8015606802-1">)</span><span class="w">
</span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="8015606802-2">(</span><span class="ss">:staging_store</span><span class="p" data-group-id="8015606802-2">)</span></code></pre><h2 id="cluster-behavior" class="section-heading"><a href="#cluster-behavior" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Cluster Behavior</span></h2><ul><li>Stores are created on the node that receives the request</li><li>Khepri handles replication across the cluster automatically</li><li>Each store maintains its own Raft consensus group</li><li>Store operations are distributed across cluster nodes via Swarm</li></ul><h2 id="backward-compatibility" class="section-heading"><a href="#backward-compatibility" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Backward Compatibility</span></h2><p>The changes are fully backward compatible:</p><ul><li>Existing single-store configurations continue to work</li><li>All existing APIs work with the default store</li><li>No migration is required for existing deployments</li></ul><h2 id="best-practices" class="section-heading"><a href="#best-practices" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Best Practices</span></h2><h3 id="store-naming" class="section-heading"><a href="#store-naming" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Store Naming</span></h3><p>Use descriptive, unique atom names:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Good</span><span class="w">
</span><span class="ss">:user_events_store</span><span class="w">
</span><span class="ss">:order_processing_store</span><span class="w">
</span><span class="ss">:analytics_events_store</span><span class="w">

</span><span class="c1"># Avoid</span><span class="w">
</span><span class="ss">:store1</span><span class="w">
</span><span class="ss">:store</span><span class="w">
</span><span class="ss">:temp</span></code></pre><h3 id="resource-management" class="section-heading"><a href="#resource-management" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Resource Management</span></h3><ul><li>Monitor store count to avoid resource exhaustion</li><li>Remove unused stores to free up resources</li><li>Consider store lifecycle in your application design</li></ul><h3 id="configuration-1" class="section-heading"><a href="#configuration-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Configuration</span></h3><ul><li>Use consistent timeout values for related stores</li><li>Plan data directory structure for backup/restore operations</li><li>Consider store-specific configuration needs</li></ul><h2 id="monitoring" class="section-heading"><a href="#monitoring" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Monitoring</span></h2><p>To monitor store health:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Get all stores and their status</span><span class="w">
</span><span class="p" data-group-id="3855879207-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">stores</span><span class="p" data-group-id="3855879207-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">list_stores</span><span class="p" data-group-id="3855879207-2">(</span><span class="p" data-group-id="3855879207-2">)</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="3855879207-3">{</span><span class="n">store_id</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p" data-group-id="3855879207-3">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stores</span><span class="w"> </span><span class="k" data-group-id="3855879207-4">do</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="3855879207-5">(</span><span class="s">&quot;Store </span><span class="si" data-group-id="3855879207-6">#{</span><span class="n">store_id</span><span class="si" data-group-id="3855879207-6">}</span><span class="s">: </span><span class="si" data-group-id="3855879207-7">#{</span><span class="n">info</span><span class="o">.</span><span class="n">status</span><span class="si" data-group-id="3855879207-7">}</span><span class="s">&quot;</span><span class="p" data-group-id="3855879207-5">)</span><span class="w">
</span><span class="k" data-group-id="3855879207-4">end</span></code></pre><h2 id="error-handling" class="section-heading"><a href="#error-handling" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Error Handling</span></h2><p>Common error scenarios:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Store already exists</span><span class="w">
</span><span class="p" data-group-id="9987249459-1">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:already_exists</span><span class="p" data-group-id="9987249459-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">create_store</span><span class="p" data-group-id="9987249459-2">(</span><span class="ss">:existing_store</span><span class="p" data-group-id="9987249459-2">)</span><span class="w">

</span><span class="c1"># Store not found</span><span class="w">
</span><span class="p" data-group-id="9987249459-3">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:not_found</span><span class="p" data-group-id="9987249459-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">get_store_status</span><span class="p" data-group-id="9987249459-4">(</span><span class="ss">:nonexistent_store</span><span class="p" data-group-id="9987249459-4">)</span><span class="w">
</span><span class="p" data-group-id="9987249459-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:not_found</span><span class="p" data-group-id="9987249459-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ExESDBGater.API</span><span class="o">.</span><span class="n">remove_store</span><span class="p" data-group-id="9987249459-6">(</span><span class="ss">:nonexistent_store</span><span class="p" data-group-id="9987249459-6">)</span></code></pre><h2 id="migration-guide" class="section-heading"><a href="#migration-guide" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Migration Guide</span></h2><p>If you're currently using a single store and want to adopt multiple stores:</p><ol><li><strong>No immediate action required</strong> - your existing setup continues to work</li><li><strong>Gradual migration</strong> - start creating new stores for new features</li><li><strong>Optional consolidation</strong> - consider reorganizing existing data into domain-specific stores</li></ol><h2 id="performance-considerations" class="section-heading"><a href="#performance-considerations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Performance Considerations</span></h2><ul><li>Each store has its own Khepri cluster member</li><li>Memory usage scales with the number of stores</li><li>Network traffic increases with store count due to more Raft groups</li><li>Consider store count limits based on cluster capacity</li></ul><h2 id="security-considerations" class="section-heading"><a href="#security-considerations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Security Considerations</span></h2><ul><li>Store creation/removal should be restricted to authorized operations</li><li>Consider implementing store-level access controls in your application</li><li>Monitor store creation for unauthorized usage</li></ul><h2 id="limitations" class="section-heading"><a href="#limitations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Limitations</span></h2><ul><li>Store IDs must be valid Elixir atoms</li><li>Each store requires cluster resources (memory, network)</li><li>Maximum practical store count depends on cluster capacity</li><li>Store removal is immediate and irreversible</li></ul><h2 id="future-enhancements" class="section-heading"><a href="#future-enhancements" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Future Enhancements</span></h2><p>Potential future improvements:</p><ul><li>Store templates for consistent configuration</li><li>Store migration utilities</li><li>Store-level metrics and monitoring</li><li>Automatic store cleanup policies</li><li>Store backup/restore functionality</li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="logger-filtering.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Logger Filtering
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="configuring-exesdb-apps.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Configuring ExESDB Applications
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ex_esdb/0.7.1" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ex_esdb/0.7.1">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/ex_esdb/0.7.1/show/guides/how_exesdb_handles_multiple_stores.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ex_esdb.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
